import base64
import os
from openai import OpenAI
from config import OPENAI_API_KEY
import re
import html

client = OpenAI(api_key=OPENAI_API_KEY)

# def upload_temp_image(path):
#     """
#     –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ (0x0.st) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π URL.
#     """
#     with open(path, "rb") as f:
#         res = requests.post("https://0x0.st", files={"file": f})
#     if res.status_code == 200:
#         return res.text.strip()
#     else:
#         raise Exception(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ {path}: {res.text}")



async def evaluate_portfolio(image_paths):
    """
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞–ø—Ä—è–º—É—é –≤ OpenAI –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–∞ –æ—Ü–µ–Ω–∫—É.
    """
    images_b64 = []

    for path in image_paths:
        try:
            with open(path, "rb") as f:
                b64 = base64.b64encode(f.read()).decode("utf-8")
                images_b64.append(b64)
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è {path}: {e}")

    if not images_b64:
        return "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è."


    # –ó–∞–ø—Ä–æ—Å –∫ GPT‚Äë4o
    response = client.chat.completions.create(
        model="gpt-4o", 
        messages=[
            {"role": "system", "content": 
                """
                –¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –∞—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä, –∫–∞–ø–µ–ª—å–∫—É —Ç–æ–∫—Å–∏—á–Ω—ã–π, –Ω–æ –æ—á–µ–Ω—å —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π.

                –¢—ã –∑–Ω–∞–µ—à—å –≤—Å—ë –æ –≤–∏–∑—É–∞–ª—å–Ω–æ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ, –≥—Ä–∞—Ñ–∏–∫–µ, —É —Ç–µ–±—è –æ–≥—Ä–æ–º–Ω—ã–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏—è—Ö, –∏ —Ç—ã –Ω–∞–Ω—è–ª –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–∑–Ω—ã—Ö –¥–∏–∑–∞–π–Ω–µ—Ä–æ–≤, –ø–æ—Ç–æ–º—É —á—Ç–æ —É–º–µ–µ—à—å –æ—Ü–µ–Ω–∏—Ç—å –ø–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏—Ö –Ω–∞–≤—ã–∫–∏ –∏ —á–µ–≥–æ –æ–Ω–∏ —Å—Ç–æ—è—Ç.

                –¢—ã –∑–Ω–∞–µ—à—å –æ –¥–∏–∑–∞–π–Ω–µ –≤—Å—ë, –Ω–æ –µ—â—ë –±–æ–ª—å—à–µ –∑–Ω–∞–µ—à—å –æ –¥–∏–∑–∞–π–Ω–µ—Ä–∞—Ö (–ª—é–±—ã—Ö ‚Äî –∏ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö, –∏ –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã—Ö, –∏ –∫–æ–Ω—Ü–µ–ø—Ç-–¥–∏–∑–∞–π–Ω–µ—Ä–∞—Ö ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω–æ –ª—é–±—ã—Ö).

                –¢—ã —Ç–∞–∫–∂–µ —Å–ø–æ—Å–æ–±–µ–Ω –æ—Ü–µ–Ω–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ –º–æ–∂–µ—Ç —Å—Ç–æ–∏—Ç—å —Ä–∞–±–æ—Ç–∞ —É –¥–∏–∑–∞–π–Ω–µ—Ä–∞ –ø–æ –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–∞—Ä—Ç–∏–Ω–∫–∞–º.

                –¢—ã –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞–µ—à—å –≤—ã–≤–æ–¥ –∏ –¥–∞—ë—à—å –∏—Ç–æ–≥–æ–≤—É—é –æ—Ü–µ–Ω–∫—É –æ—Ç 0 –¥–æ 10.

                –°–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ:
                –¢—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—à—å –±–µ—Å–ø—Ä–∏—Å—Ç—Ä–∞—Å—Ç–Ω–æ –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ ‚Äî –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞ –ø–ª–æ—Ö–∞—è, —Ç—ã –Ω–µ –±—É–¥–µ—à—å —É–≤–∏–ª–∏–≤–∞—Ç—å –∏ –ø—Ä–∏—É–∫—Ä–∞—à–∏–≤–∞—Ç—å, —Å—Ä–∞–∑—É —Å–∫–∞–∂–µ—à—å –æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞—Ö —Ç–∏–ø–∞ –ø–ª–æ—Ö–æ–π –≤–µ—Ä—Å—Ç–∫–∏, –æ–ø–µ—á–∞—Ç–∫–∞—Ö, –æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω—ã—Ö —Ü–≤–µ—Ç–∞—Ö –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

                –¢—ã –Ω–µ –±—É–¥–µ—à—å —Å—Ç–µ—Å–Ω—è—Ç—å—Å—è –∏ –ø—Ä–∏—É–∫—Ä–∞—à–∏–≤–∞—Ç—å –∏ –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–≤–∏—à—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —á–µ—Å—Ç–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏, –±–µ–∑ –ª–∏–∑–æ–±–ª—é–¥—Å—Ç–≤–∞ –∏ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–Ω—Ä–∞–≤–∏—Ç—å—Å—è –∏–ª–∏ —É–≥–æ–¥–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äî –µ—Å–ª–∏ –≤–µ—Ä—Å—Ç–∫–∞ –≥–æ–≤–Ω–æ, —Ü–≤–µ—Ç–∞ –≤—ã—Ä–≤–∏–≥–ª–∞–∑–Ω—ã–µ, –¥–∏–∑–∞–π–Ω –≤—ã–≥–ª—è–¥–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–º, –∏–¥–µ–∏ —Å–∫—É—á–Ω—ã–µ –∏ —Ç.–¥. ‚Äî —Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–∫–∞–∂–µ—à—å —ç—Ç–æ.
                """
            },

            {"role": "assistant",
                "content": """
                –õ–∞–¥–Ω–æ, –¥–∞–≤–∞–π –ø–æ –ø–æ—Ä—è–¥–∫—É, –±–µ–∑ —Ä–µ–≤–µ—Ä–∞–Ω—Å–æ–≤.

                1 –∏ 2 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (ALEF ‚Äî –º–µ—Ö–æ–≤–∞—è —Ñ–∞–±—Ä–∏–∫–∞)

                –í–µ—Ä—Å—Ç–∫–∞ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è –∏ –±–µ–∑ —á—É–≤—Å—Ç–≤–∞ –±–∞–ª–∞–Ω—Å–∞. –ù–∞ –ø–µ—Ä–≤–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ ¬´–≤–æ–∑–¥—É—Ö–∞¬ª –≤–≤–µ—Ä—Ö—É, –ª–æ–≥–æ—Ç–∏–ø –±–∞–Ω–∞–ª—å–Ω–æ –ø—Ä–∏–±–∏—Ç –∫ —Ü–µ–Ω—Ç—Ä—É, –±–µ–∑ –∏–≥—Ä—ã —Å –∫–æ–º–ø–æ–∑–∏—Ü–∏–µ–π. –ù–∞ –≤—Ç–æ—Ä–æ–π ‚Äî –±–∞–Ω–Ω–µ—Ä –≤ –¥—É—Ö–µ –ø—Ä–æ–≤–∏–Ω—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞—Ä—É–∂–∫–∏ –Ω–∞—á–∞–ª–∞ 2010‚Äë—Ö: –∫–∏—Å–ª–æ—Ç–Ω–æ-–∂—ë–ª—Ç—ã–π —Ñ–æ–Ω, –∫—Ä–∏–∫–ª–∏–≤—ã–π —Ç–µ–∫—Å—Ç, –∫—É—á–∞ —Ä–∞–∑–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤ –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –º—É—Å–æ—Ä–∞. QR‚Äë–∫–æ–¥ –≤ —Ü–µ–Ω—Ç—Ä–µ –±–ª–æ–∫–∞ —Å–º–æ—Ç—Ä–∏—Ç—Å—è –∫–∞–∫ –∏–Ω–æ—Ä–æ–¥–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç. –°—Ç–æ–∫–æ–≤–∞—è —ç–º–æ—Ü–∏—è –¥–µ–≤—É—à–∫–∏ ‚Äî —Ñ–∞–ª—å—à–∏–≤–∞—è, –Ω–µ –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–∞—è.
                –¶–≤–µ—Ç–∞: –∂—ë–ª—Ç—ã–π+–∫—Ä–∞—Å–Ω—ã–π ‚Äî —ç—Ç–æ –∫—Ä–∏—á–∞—â–µ –∏ –¥–µ—à–µ–≤–æ. –í–æ–∑–º–æ–∂–Ω–æ, –¥–∏–∑–∞–π–Ω–µ—Ä –ø—Ä–æ—Å—Ç–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ ¬´–∑–∞–º–µ—Ç–Ω–æ—Å—Ç—å¬ª, –Ω–æ –≤ 2025 —Ç–∞–∫ —É–∂–µ –Ω–µ –¥–µ–ª–∞—é—Ç.
                –ò—Ç–æ–≥–æ: —É—Ä–æ–≤–µ–Ω—å ‚Äî –Ω–∏–∑–∫–∏–π middle, –±–ª–∏–∂–µ –∫ junior.
                –û—Ü–µ–Ω–∫–∞: 3.5/10.
                3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—Ä–µ—Ç—Ä–æ‚Äë—Ñ—É—Ç—É—Ä–∏–∑–º, –∫–æ—Å–º–æ—Å, —Å–æ–≤–µ—Ç—Å–∫–∏–π —Å—Ç–∏–ª—å)

                –í–æ—Ç —Ç—É—Ç —É–∂–µ –≤–∏–¥–Ω–æ —É–º–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π –∏ —Å—Ç–∏–ª–µ–º. –û—á–µ–Ω—å –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ü–≤–µ—Ç–æ–º, –æ—Ç–ª–∏—á–Ω–æ–µ —á—É–≤—Å—Ç–≤–æ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –∏ –¥—Ä–∞–º–∞—Ç—É—Ä–≥–∏–∏ –∫–∞–¥—Ä–∞. –°—Ç–∏–ª–∏—Å—Ç–∏–∫–∞ –≤—ã–¥–µ—Ä–∂–∞–Ω–∞, –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ —Ü–µ–ø–ª—è—é—Ç. –≠—Ç–æ –Ω–µ —É—Ä–æ–≤–µ–Ω—å ¬´–ø–æ—Å—Ç–∞–≤–∏–ª —à—Ä–∏—Ñ—Ç –∏ –∫–∞—Ä—Ç–∏–Ω–∫—É¬ª ‚Äî —ç—Ç–æ –∫–æ–Ω—Ü–µ–ø—Ç‚Äë–∞—Ä—Ç –∏–ª–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–º–æ‚Äë–≥—Ä–∞—Ñ–∏–∫–∞.
                –í–µ—Ä–æ—è—Ç–Ω–æ, —Å–¥–µ–ª–∞–Ω–æ –≤ midjourney –∏–ª–∏ –¥—Ä—É–≥–æ–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ —Å –¥–æ—Ä–∞–±–æ—Ç–∫–æ–π, –Ω–æ –ø–æ–¥–±–æ—Ä –∏ –ø–æ—Å—Ç‚Äë–ø—Ä–æ–¥–∞–∫—à–Ω –æ—Ç–ª–∏—á–Ω—ã–µ.
                –û—Ü–µ–Ω–∫–∞: 8/10.
                4 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—Å–µ—Ç–∫–∞ –∏–∑ 8 —Ä–∞–∑–Ω–æ–ø–ª–∞–Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫)

                –≠—Ç–æ —É–∂–µ –±–ª–∏–∂–µ –∫ moodboard/–ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ-–∫–æ–ª–ª–∞–∂—É. –ó–¥–µ—Å—å –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å –∫ —Ä–∞–∑–Ω—ã–º –∂–∞–Ω—Ä–∞–º: –ø—Ä–µ–¥–º–µ—Ç–∫–∞ (–ø–∞—Ä—Ñ—é–º), –Ω–µ–æ–Ω+–≥–ª–∏—Ç—á, 3D‚Äë—Ä–µ–Ω–¥–µ—Ä—ã, —Ñ—É–¥-—Ñ–æ—Ç–æ, –∏–∑–æ–º–µ—Ç—Ä–∏—è. –ù–æ –≤–∏–¥–Ω–æ, —á—Ç–æ —Å—Ç–∏–ª–∏ —Å–ª–∏—à–∫–æ–º —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–µ ‚Äî –∫–∞–∫ –±—É–¥—Ç–æ –¥–∏–∑–∞–π–Ω–µ—Ä –ø—Ä–æ—Å—Ç–æ –Ω–∞—Å–æ–±–∏—Ä–∞–ª —É–¥–∞—á–Ω—ã–µ –∫–∞–¥—Ä—ã –±–µ–∑ –µ–¥–∏–Ω–æ–π –∞–≤—Ç–æ—Ä—Å–∫–æ–π –ª–∏–Ω–∏–∏. –ß–∞—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–æ–∫, –æ–ø—è—Ç—å –∂–µ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–∫–∞, –∞ –Ω–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä.
                –ü–ª—é—Å ‚Äî —É–º–µ–Ω–∏–µ –ø–æ–¥–±–∏—Ä–∞—Ç—å —ç—Å—Ç–µ—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—è—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã, –º–∏–Ω—É—Å ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–æ–≥–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–æ—á–µ—Ä–∫–∞.
                –û—Ü–µ–Ω–∫–∞: 6/10.
                –í—ã–≤–æ–¥:
                –≠—Ç–æ—Ç –¥–∏–∑–∞–π–Ω–µ—Ä ‚Äî —è–≤–Ω–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ —Å —Ä–µ–∫–ª–∞–º–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–µ–π, –∏ —Å –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è–º–∏, –Ω–æ –≤ –æ—Ñ–ª–∞–π–Ω‚Äë—Ä–µ–∫–ª–∞–º–µ –∏ –≤–µ—Ä—Å—Ç–∫–µ –æ–Ω —Å–ª–∞–±. –í –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∏–ª—è—Ö (—Ä–µ—Ç—Ä–æ‚Äë—Ñ—É—Ç—É—Ä–∏–∑–º, –∫–æ–Ω—Ü–µ–ø—Ç‚Äë–∞—Ä—Ç, moodboards) ‚Äî —Å–∏–ª—å–Ω–µ–µ. –°—Ç–∞–≤–∫–∞ –Ω–∞ –Ω–∞—Ä—É–∂–∫—É –∏ –∫–∞—Ç–∞–ª–æ–≥–∏ ‚Äî –ø—Ä–æ–∏–≥—Ä—ã—à–Ω–∞—è, –Ω–∞ –∞—Ä—Ç‚Äë–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ digital‚Äë–≤–∏–∑—É–∞–ª—ã ‚Äî –≤—ã–∏–≥—Ä—ã—à–Ω–∞—è.

                üí∞ –†—ã–Ω–æ–∫: –≤ –°–ù–ì ‚Äî 60‚Äì80 —Ç—ã—Å. ‚ÇΩ/–º–µ—Å –∫–∞–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª. –í –ï–≤—Ä–æ–ø–µ/–°–®–ê –∫–∞–∫ –∫–æ–Ω—Ü–µ–ø—Ç‚Äë–∞—Ä—Ç–∏—Å—Ç (–µ—Å–ª–∏ –ø–æ–¥—Ç—è–Ω—É—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å) –º–æ–∂–Ω–æ –ø—Ä–µ—Ç–µ–Ω–¥–æ–≤–∞—Ç—å –Ω–∞ $150‚Äì250 –∑–∞ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—é.
                """
            },

            {"role": "user", 
                    "content": [
                        *[
                            {
                                "type": "image_url",
                                "image_url": {"url": f"data:image/jpeg;base64,{b64}"}
                            }
                            for b64 in images_b64
                        ],
                        {"type": "text", "text": "–û—Ü–µ–Ω–∏ –≤—Å–µ —ç—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–∫ –µ–¥–∏–Ω–æ–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –¥–∏–∑–∞–π–Ω–µ—Ä–∞, –Ω–æ –¥–∞–π –æ—Ü–µ–Ω–∫—É –æ—Ç 0 –¥–æ 10 –ø–æ –∫–∞–∂–¥–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –∏ –Ω–µ –∑–∞–±—É–¥—å —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ –∫–∞–∫ –∞—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä —Å –∏—Ç–æ–≥–æ–≤–æ–π –æ—Ü–µ–Ω–∫–æ–π, –ø—Ä–∏–º–µ—Ä–Ω—ã–º —Ü–µ–Ω–Ω–∏–∫–æ–º –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö, –ø—Ä–∏–º–µ—Ä–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –¥–∏–∑–∞–π–Ω–µ—Ä–∞ (junior, middle, senior, art-director –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π)"}
                    ]
            }
        ],
        temperature=0.7
    )


    raw_text = response.choices[0].message.content
    return gpt_markdown_to_telegram_html(raw_text)


def gpt_markdown_to_telegram_html(markdown_text: str) -> str:
    # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º HTML, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
    text = html.escape(markdown_text)

    # –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç **...**
    text = re.sub(r"\*\*(.+?)\*\*", r"<b>\1</b>", text)

    # –ö—É—Ä—Å–∏–≤ *...*
    text = re.sub(r"\*(.+?)\*", r"<i>\1</i>", text)

    # –ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
    text = re.sub(r"^\s*-\s+", "‚Ä¢ ", text, flags=re.MULTILINE)

    # –ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏ (–±–µ–∑ —Å—Å—ã–ª–æ–∫ –Ω–∞ –≥—Ä—É–ø–ø—ã)
    text = re.sub(r"^\s*(\d+)\.\s+", r"\1. ", text, flags=re.MULTILINE)

    # <br> ‚Üí –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏
    text = text.replace("<br>", "\n")

    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã
    text = re.sub(r"\n{3,}", "\n\n", text)

    return text.strip()



    # # –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Data URL
    # for path in image_paths:
    #     if not os.path.exists(path):
    #         continue
    #     with open(path, "rb") as f:
    #         img_bytes = f.read()
    #     img_base64 = base64.b64encode(img_bytes).decode("utf-8")
    #     content.append({
    #         "type": "image_url",
    #         "image_url": {
    #             "url": f"data:image/jpeg;base64,{img_base64}"
    #         }
    #     })



# def generate_feedback(behance_data: dict) -> str:
#     """
#     –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–∂–∞—Ä–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö —Å Behance
#     """
#     # title = behance_data.get("title", "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è")
#     # url = behance_data.get("url", "")
#     # image = behance_data.get("image", "")

#     prompt = f"""
        
#         –í–æ—Ç –¥–∞–Ω–Ω—ã–µ:

#         # –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞: {title}
#         # –°—Å—ã–ª–∫–∞: {url}
#         # –ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {image}

#         –æ—Ü–µ–Ω–∏ –¥–∏–∑–∞–π–Ω–µ—Ä–∞ –ø–æ —ç—Ç–∏–º –∫–∞—Ä—Ç–∏–Ω–∫–∞–º –∏–∑ –µ–≥–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ
# """

#     chat_response = client.chat.completions.create(
#         model="gpt-4o",
#         messages=[
#             {"role": "system", "content": 
#                 """
#                 –¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π –∞—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä, —Å–æ–≤—Å–µ–º –∫–∞–ø–µ–ª—å–∫—É —Ç–æ–∫—Å–∏—á–Ω—ã–π, –Ω–æ –æ—á–µ–Ω—å —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π.

#                 –¢—ã –∑–Ω–∞–µ—à—å –≤—Å—ë –æ –≤–∏–∑—É–∞–ª—å–Ω–æ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ, –≥—Ä–∞—Ñ–∏–∫–µ, —É —Ç–µ–±—è –æ–≥—Ä–æ–º–Ω—ã–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏—è—Ö, –∏ —Ç—ã –Ω–∞–Ω—è–ª –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–∑–Ω—ã—Ö –¥–∏–∑–∞–π–Ω–µ—Ä–æ–≤, –ø–æ—Ç–æ–º—É —á—Ç–æ —É–º–µ–µ—à—å –æ—Ü–µ–Ω–∏—Ç—å –ø–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏—Ö –Ω–∞–≤—ã–∫–∏ –∏ —á–µ–≥–æ –æ–Ω–∏ —Å—Ç–æ—è—Ç.

#                 –¢—ã –∑–Ω–∞–µ—à—å –æ –¥–∏–∑–∞–π–Ω–µ –≤—Å—ë, –Ω–æ –µ—â—ë –±–æ–ª—å—à–µ –∑–Ω–∞–µ—à—å –æ –¥–∏–∑–∞–π–Ω–µ—Ä–∞—Ö (–ª—é–±—ã—Ö ‚Äî –∏ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö, –∏ –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã—Ö, –∏ –∫–æ–Ω—Ü–µ–ø—Ç-–¥–∏–∑–∞–π–Ω–µ—Ä–∞—Ö ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω–æ –ª—é–±—ã—Ö).

#                 –¢—ã —Ç–∞–∫–∂–µ —Å–ø–æ—Å–æ–±–µ–Ω –æ—Ü–µ–Ω–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ –º–æ–∂–µ—Ç —Å—Ç–æ–∏—Ç—å —Ä–∞–±–æ—Ç–∞ —É –¥–∏–∑–∞–π–Ω–µ—Ä–∞ –ø–æ –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–∞—Ä—Ç–∏–Ω–∫–∞–º.

#                 –¢—ã –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞–µ—à—å –≤—ã–≤–æ–¥ –∏ –¥–∞—ë—à—å –∏—Ç–æ–≥–æ–≤—É—é –æ—Ü–µ–Ω–∫—É –æ—Ç 0 –¥–æ 10.

#                 –°–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ:
#                 –¢—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—à—å –±–µ—Å–ø—Ä–∏—Å—Ç—Ä–∞—Å—Ç–Ω–æ –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ ‚Äî –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞ –ø–ª–æ—Ö–∞—è, —Ç—ã –Ω–µ –±—É–¥–µ—à—å —É–≤–∏–ª–∏–≤–∞—Ç—å –∏ –ø—Ä–∏—É–∫—Ä–∞—à–∏–≤–∞—Ç—å, —Å—Ä–∞–∑—É —Å–∫–∞–∂–µ—à—å –æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞—Ö —Ç–∏–ø–∞ –ø–ª–æ—Ö–æ–π –≤–µ—Ä—Å—Ç–∫–∏, –æ–ø–µ—á–∞—Ç–∫–∞—Ö, –æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω—ã—Ö —Ü–≤–µ—Ç–∞—Ö –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

#                 –¢—ã –Ω–µ –±—É–¥–µ—à—å —Å—Ç–µ—Å–Ω—è—Ç—å—Å—è –∏ –ø—Ä–∏—É–∫—Ä–∞—à–∏–≤–∞—Ç—å –∏ –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–≤–∏—à—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —á–µ—Å—Ç–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏, –±–µ–∑ –ª–∏–∑–æ–±–ª—é–¥—Å—Ç–≤–∞ –∏ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–Ω—Ä–∞–≤–∏—Ç—å—Å—è –∏–ª–∏ —É–≥–æ–¥–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äî –µ—Å–ª–∏ –≤–µ—Ä—Å—Ç–∫–∞ –≥–æ–≤–Ω–æ, —Ü–≤–µ—Ç–∞ –≤—ã—Ä–≤–∏–≥–ª–∞–∑–Ω—ã–µ, –¥–∏–∑–∞–π–Ω –≤—ã–≥–ª—è–¥–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–º, –∏–¥–µ–∏ —Å–∫—É—á–Ω—ã–µ –∏ —Ç.–¥. ‚Äî —Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–∫–∞–∂–µ—à—å —ç—Ç–æ.
#                 """
#             },
#             {"role": "user", "content": prompt}
#         ],
#         temperature=0.7
#     )

#     return chat_response.choices[0].message.content.strip()
